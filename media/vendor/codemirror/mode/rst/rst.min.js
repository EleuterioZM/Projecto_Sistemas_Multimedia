(function(f){typeof exports=="object"&&typeof module=="object"?f(require("../../lib/codemirror"),require("../python/python"),require("../stex/stex"),require("../../addon/mode/overlay")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","../python/python","../stex/stex","../../addon/mode/overlay"],f):f(CodeMirror)})(function(f){"use strict";f.defineMode("rst",function(q,o){var m=/^\*\*[^\*\s](?:[^\*]*[^\*\s])?\*\*/,v=/^\*[^\*\s](?:[^\*]*[^\*\s])?\*/,w=/^``[^`\s](?:[^`]*[^`\s])``/,x=/^(?:[\d]+(?:[\.,]\d+)*)/,g=/^(?:\s\+[\d]+(?:[\.,]\d+)*)/,_=/^(?:\s\-[\d]+(?:[\.,]\d+)*)/,$="[Hh][Tt][Tt][Pp][Ss]?://",X="(?:[\\d\\w.-]+)\\.(?:\\w{2,6})",u="(?:/[\\d\\w\\#\\%\\&\\-\\.\\,\\/\\:\\=\\?\\~]+)*",E=new RegExp("^"+$+X+u),y={token:function(a){if(a.match(m)&&a.match(/\W+|$/,!1))return"strong";if(a.match(v)&&a.match(/\W+|$/,!1))return"em";if(a.match(w)&&a.match(/\W+|$/,!1))return"string-2";if(a.match(x))return"number";if(a.match(g))return"positive";if(a.match(_))return"negative";if(a.match(E))return"link";for(;a.next()!=null&&!(a.match(m,!1)||a.match(v,!1)||a.match(w,!1)||a.match(x,!1)||a.match(g,!1)||a.match(_,!1)||a.match(E,!1)););return null}},T=f.getMode(q,o.backdrop||"rst-base");return f.overlayMode(T,y,!0)},"python","stex"),f.defineMode("rst-base",function(q){function o(n){var e=Array.prototype.slice.call(arguments,1);return n.replace(/{(\d+)}/g,function(i,N){return typeof e[N]<"u"?e[N]:i})}var m=f.getMode(q,"python"),v=f.getMode(q,"stex"),w="\\s+",x="(?:\\s*|\\W|$)",g=new RegExp(o("^{0}",x)),_=`(?:[^\\W\\d_](?:[\\w!"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)`,$=new RegExp(o("^{0}",_)),X=`(?:[^\\W\\d_](?:[\\w\\s!"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)`,u=o("(?:{0}|`{1}`)",_,X),E="(?:[^\\s\\|](?:[^\\|]*[^\\s\\|])?)",y="(?:[^\\`]+)",T=new RegExp(o("^{0}",y)),a=new RegExp("^([!'#$%&\"()*+,-./:;<=>?@\\[\\\\\\]^_`{|}~])\\1{3,}\\s*$"),P=new RegExp(o("^\\.\\.{0}",w)),A=new RegExp(o("^_{0}:{1}|^__:{1}",u,x)),W=new RegExp(o("^{0}::{1}",u,x)),R=new RegExp(o("^\\|{0}\\|{1}{2}::{3}",E,w,u,x)),F=new RegExp(o("^\\[(?:\\d+|#{0}?|\\*)]{1}",u,x)),H=new RegExp(o("^\\[{0}\\]{1}",u,x)),I=new RegExp(o("^\\|{0}\\|",E)),z=new RegExp(o("^\\[(?:\\d+|#{0}?|\\*)]_",u)),B=new RegExp(o("^\\[{0}\\]_",u)),D=new RegExp(o("^{0}__?",u)),b=new RegExp(o("^`{0}`_",y)),p=new RegExp(o("^:{0}:`{1}`{2}",_,y,x)),t=new RegExp(o("^`{1}`:{0}:{2}",_,y,x)),S=new RegExp(o("^:{0}:{1}",_,x)),G=new RegExp(o("^{0}",u)),J=new RegExp(o("^::{0}",x)),L=new RegExp(o("^\\|{0}\\|",E)),K=new RegExp(o("^{0}",w)),O=new RegExp(o("^{0}",u)),Q=new RegExp(o("^::{0}",x)),U=new RegExp("^_"),V=new RegExp(o("^{0}|_",u)),Y=new RegExp(o("^:{0}",x)),Z=new RegExp("^::\\s*$"),s=new RegExp("^\\s+(?:>>>|In \\[\\d+\\]:)\\s");function r(n,e){var i=null;if(n.sol()&&n.match(s,!1))c(e,j,{mode:m,local:f.startState(m)});else if(n.sol()&&n.match(P))c(e,h),i="meta";else if(n.sol()&&n.match(a))c(e,r),i="header";else if(k(e)==p||n.match(p,!1))switch(d(e)){case 0:c(e,r,l(p,1)),n.match(/^:/),i="meta";break;case 1:c(e,r,l(p,2)),n.match($),i="keyword",n.current().match(/^(?:math|latex)/)&&(e.tmp_stex=!0);break;case 2:c(e,r,l(p,3)),n.match(/^:`/),i="meta";break;case 3:if(e.tmp_stex&&(e.tmp_stex=void 0,e.tmp={mode:v,local:f.startState(v)}),e.tmp){if(n.peek()=="`"){c(e,r,l(p,4)),e.tmp=void 0;break}i=e.tmp.mode.token(n,e.tmp.local);break}c(e,r,l(p,4)),n.match(T),i="string";break;case 4:c(e,r,l(p,5)),n.match(/^`/),i="meta";break;case 5:c(e,r,l(p,6)),n.match(g);break;default:c(e,r)}else if(k(e)==t||n.match(t,!1))switch(d(e)){case 0:c(e,r,l(t,1)),n.match(/^`/),i="meta";break;case 1:c(e,r,l(t,2)),n.match(T),i="string";break;case 2:c(e,r,l(t,3)),n.match(/^`:/),i="meta";break;case 3:c(e,r,l(t,4)),n.match($),i="keyword";break;case 4:c(e,r,l(t,5)),n.match(/^:/),i="meta";break;case 5:c(e,r,l(t,6)),n.match(g);break;default:c(e,r)}else if(k(e)==S||n.match(S,!1))switch(d(e)){case 0:c(e,r,l(S,1)),n.match(/^:/),i="meta";break;case 1:c(e,r,l(S,2)),n.match($),i="keyword";break;case 2:c(e,r,l(S,3)),n.match(/^:/),i="meta";break;case 3:c(e,r,l(S,4)),n.match(g);break;default:c(e,r)}else if(k(e)==I||n.match(I,!1))switch(d(e)){case 0:c(e,r,l(I,1)),n.match(L),i="variable-2";break;case 1:c(e,r,l(I,2)),n.match(/^_?_?/)&&(i="link");break;default:c(e,r)}else if(n.match(z))c(e,r),i="quote";else if(n.match(B))c(e,r),i="quote";else if(n.match(D))c(e,r),(!n.peek()||n.peek().match(/^\W$/))&&(i="link");else if(k(e)==b||n.match(b,!1))switch(d(e)){case 0:!n.peek()||n.peek().match(/^\W$/)?c(e,r,l(b,1)):n.match(b);break;case 1:c(e,r,l(b,2)),n.match(/^`/),i="link";break;case 2:c(e,r,l(b,3)),n.match(T);break;case 3:c(e,r,l(b,4)),n.match(/^`_/),i="link";break;default:c(e,r)}else n.match(Z)?c(e,ee):n.next()&&c(e,r);return i}function h(n,e){var i=null;if(k(e)==R||n.match(R,!1))switch(d(e)){case 0:c(e,h,l(R,1)),n.match(L),i="variable-2";break;case 1:c(e,h,l(R,2)),n.match(K);break;case 2:c(e,h,l(R,3)),n.match(O),i="keyword";break;case 3:c(e,h,l(R,4)),n.match(Q),i="meta";break;default:c(e,r)}else if(k(e)==W||n.match(W,!1))switch(d(e)){case 0:c(e,h,l(W,1)),n.match(G),i="keyword",n.current().match(/^(?:math|latex)/)?e.tmp_stex=!0:n.current().match(/^python/)&&(e.tmp_py=!0);break;case 1:c(e,h,l(W,2)),n.match(J),i="meta",(n.match(/^latex\s*$/)||e.tmp_stex)&&(e.tmp_stex=void 0,c(e,j,{mode:v,local:f.startState(v)}));break;case 2:c(e,h,l(W,3)),(n.match(/^python\s*$/)||e.tmp_py)&&(e.tmp_py=void 0,c(e,j,{mode:m,local:f.startState(m)}));break;default:c(e,r)}else if(k(e)==A||n.match(A,!1))switch(d(e)){case 0:c(e,h,l(A,1)),n.match(U),n.match(V),i="link";break;case 1:c(e,h,l(A,2)),n.match(Y),i="meta";break;default:c(e,r)}else n.match(F)||n.match(H)?(c(e,r),i="quote"):(n.eatSpace(),n.eol()?c(e,r):(n.skipToEnd(),c(e,C),i="comment"));return i}function C(n,e){return M(n,e,"comment")}function ee(n,e){return M(n,e,"meta")}function M(n,e,i){return n.eol()||n.eatSpace()?(n.skipToEnd(),i):(c(e,r),null)}function j(n,e){return e.ctx.mode&&e.ctx.local?n.sol()?(n.eatSpace()||c(e,r),null):e.ctx.mode.token(n,e.ctx.local):(c(e,r),null)}function l(n,e,i,N){return{phase:n,stage:e,mode:i,local:N}}function c(n,e,i){n.tok=e,n.ctx=i||{}}function d(n){return n.ctx.stage||0}function k(n){return n.ctx.phase}return{startState:function(){return{tok:r,ctx:l(void 0,0)}},copyState:function(n){var e=n.ctx,i=n.tmp;return e.local&&(e={mode:e.mode,local:f.copyState(e.mode,e.local)}),i&&(i={mode:i.mode,local:f.copyState(i.mode,i.local)}),{tok:n.tok,ctx:e,tmp:i}},innerMode:function(n){return n.tmp?{state:n.tmp.local,mode:n.tmp.mode}:n.ctx.mode?{state:n.ctx.local,mode:n.ctx.mode}:null},token:function(n,e){return e.tok(n,e)}}},"python","stex"),f.defineMIME("text/x-rst","rst")});
