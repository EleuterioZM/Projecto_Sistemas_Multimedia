(function(v){typeof exports=="object"&&typeof module=="object"?v(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],v):v(CodeMirror)})(function(v){"use strict";var O=v.Pos;function l(f,s,o){return o?f.indexOf(s)>=0:f.lastIndexOf(s,0)==0}function G(f,s){var o=s&&s.schemaInfo,d=s&&s.quoteChar||'"',p=s&&s.matchInMiddle;if(!o)return;var n=f.getCursor(),r=f.getTokenAt(n);r.end>n.ch&&(r.end=n.ch,r.string=r.string.slice(0,n.ch-r.start));var t=v.innerMode(f.getMode(),r.state);if(!t.mode.xmlCurrentTag)return;var c=[],x=!1,e,P=/\btag\b/.test(r.type)&&!/>$/.test(r.string),A=P&&/^\w/.test(r.string),b;if(A){var w=f.getLine(n.line).slice(Math.max(0,r.start-2),r.start),h=/<\/$/.test(w)?"close":/<$/.test(w)?"open":null;h&&(b=r.start-(h=="close"?2:1))}else P&&r.string=="<"?h="open":P&&r.string=="</"&&(h="close");var k=t.mode.xmlCurrentTag(t.state);if(!P&&!k||h){A&&(e=r.string),x=h;var q=t.mode.xmlCurrentContext?t.mode.xmlCurrentContext(t.state):[],t=q.length&&q[q.length-1],m=t&&o[t],y=t?m&&m.children:o["!top"];if(y&&h!="close")for(var I=0;I<y.length;++I)(!e||l(y[I],e,p))&&c.push("<"+y[I]);else if(h!="close")for(var C in o)o.hasOwnProperty(C)&&C!="!top"&&C!="!attrs"&&(!e||l(C,e,p))&&c.push("<"+C);t&&(!e||h=="close"&&l(t,e,p))&&c.push("</"+t+">")}else{var m=k&&o[k.name],i=m&&m.attrs,a=o["!attrs"];if(!i&&!a)return;if(!i)i=a;else if(a){var j={};for(var g in a)a.hasOwnProperty(g)&&(j[g]=a[g]);for(var g in i)i.hasOwnProperty(g)&&(j[g]=i[g]);i=j}if(r.type=="string"||r.string=="="){var w=f.getRange(O(n.line,Math.max(0,n.ch-60)),O(n.line,r.type=="string"?r.start:r.end)),H=w.match(/([^\s\u00a0=<>\"\']+)=$/),u;if(!H||!i.hasOwnProperty(H[1])||!(u=i[H[1]]))return;if(typeof u=="function"&&(u=u.call(this,f)),r.type=="string"){e=r.string;var R=0;/['"]/.test(r.string.charAt(0))&&(d=r.string.charAt(0),e=r.string.slice(1),R++);var S=r.string.length;if(/['"]/.test(r.string.charAt(S-1))&&(d=r.string.charAt(S-1),e=r.string.substr(R,S-2)),R){var B=f.getLine(n.line);B.length>r.end&&B.charAt(r.end)==d&&r.end++}x=!0}var D=function(M){if(M)for(var $=0;$<M.length;++$)(!e||l(M[$],e,p))&&c.push(d+M[$]+d);return E()};return u&&u.then?u.then(D):D(u)}else{r.type=="attribute"&&(e=r.string,x=!0);for(var z in i)i.hasOwnProperty(z)&&(!e||l(z,e,p))&&c.push(z)}}function E(){return{list:c,from:x?O(n.line,b??r.start):n,to:x?O(n.line,r.end):n}}return E()}v.registerHelper("hint","xml",G)});
