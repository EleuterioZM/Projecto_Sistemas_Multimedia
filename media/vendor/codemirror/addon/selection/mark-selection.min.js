(function(a){typeof exports=="object"&&typeof module=="object"?a(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)})(function(a){"use strict";a.defineOption("styleSelectedText",!1,function(e,t,r){var n=r&&r!=a.Init;t&&!n?(e.state.markedSelection=[],e.state.markedSelectionStyle=typeof t=="string"?t:"CodeMirror-selectedtext",v(e),e.on("cursorActivity",S),e.on("change",p)):!t&&n&&(e.off("cursorActivity",S),e.off("change",p),u(e),e.state.markedSelection=e.state.markedSelectionStyle=null)});function S(e){e.state.markedSelection&&e.operation(function(){k(e)})}function p(e){e.state.markedSelection&&e.state.markedSelection.length&&e.operation(function(){u(e)})}var s=8,g=a.Pos,l=a.cmpPos;function f(e,t,r,n){if(l(t,r)!=0)for(var i=e.state.markedSelection,o=e.state.markedSelectionStyle,c=t.line;;){var b=c==t.line?t:g(c,0),d=c+s,h=d>=r.line,x=h?r:g(d,0),y=e.markText(b,x,{className:o});if(n==null?i.push(y):i.splice(n++,0,y),h)break;c=d}}function u(e){for(var t=e.state.markedSelection,r=0;r<t.length;++r)t[r].clear();t.length=0}function v(e){u(e);for(var t=e.listSelections(),r=0;r<t.length;r++)f(e,t[r].from(),t[r].to())}function k(e){if(!e.somethingSelected())return u(e);if(e.listSelections().length>1)return v(e);var t=e.getCursor("start"),r=e.getCursor("end"),n=e.state.markedSelection;if(!n.length)return f(e,t,r);var i=n[0].find(),o=n[n.length-1].find();if(!i||!o||r.line-t.line<=s||l(t,o.to)>=0||l(r,i.from)<=0)return v(e);for(;l(t,i.from)>0;)n.shift().clear(),i=n[0].find();for(l(t,i.from)<0&&(i.to.line-t.line<s?(n.shift().clear(),f(e,t,i.to,0)):f(e,t,i.from,0));l(r,o.to)<0;)n.pop().clear(),o=n[n.length-1].find();l(r,o.to)>0&&(r.line-o.from.line<s?(n.pop().clear(),f(e,o.from,r)):f(e,o.to,r))}});
