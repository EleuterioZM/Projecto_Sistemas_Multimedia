(function(l){typeof exports=="object"&&typeof module=="object"?l(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],l):l(CodeMirror)})(function(l){"use strict";function c(e,n,t,f){if(t&&t.call){var i=t;t=null}else var i=o(e,t,"rangeFinder");typeof n=="number"&&(n=l.Pos(n,0));var y=o(e,t,"minFoldSize");function g(u){var a=i(e,n);if(!a||a.to.line-a.from.line<y)return null;if(f==="fold")return a;for(var s=e.findMarksAt(a.from),d=0;d<s.length;++d)if(s[d].__isFold){if(!u)return null;a.cleared=!0,s[d].clear()}return a}var r=g(!0);if(o(e,t,"scanUp"))for(;!r&&n.line>e.firstLine();)n=l.Pos(n.line-1,0),r=g(!1);if(!(!r||r.cleared||f==="unfold")){var v=F(e,t,r);l.on(v,"mousedown",function(u){p.clear(),l.e_preventDefault(u)});var p=e.markText(r.from,r.to,{replacedWith:v,clearOnEnter:o(e,t,"clearOnEnter"),__isFold:!0});p.on("clear",function(u,a){l.signal(e,"unfold",e,u,a)}),l.signal(e,"fold",e,r.from,r.to)}}function F(e,n,t){var f=o(e,n,"widget");if(typeof f=="function"&&(f=f(t.from,t.to)),typeof f=="string"){var i=document.createTextNode(f);f=document.createElement("span"),f.appendChild(i),f.className="CodeMirror-foldmarker"}else f&&(f=f.cloneNode(!0));return f}l.newFoldFunction=function(e,n){return function(t,f){c(t,f,{rangeFinder:e,widget:n})}},l.defineExtension("foldCode",function(e,n,t){c(this,e,n,t)}),l.defineExtension("isFolded",function(e){for(var n=this.findMarksAt(e),t=0;t<n.length;++t)if(n[t].__isFold)return!0}),l.commands.toggleFold=function(e){e.foldCode(e.getCursor())},l.commands.fold=function(e){e.foldCode(e.getCursor(),null,"fold")},l.commands.unfold=function(e){e.foldCode(e.getCursor(),{scanUp:!1},"unfold")},l.commands.foldAll=function(e){e.operation(function(){for(var n=e.firstLine(),t=e.lastLine();n<=t;n++)e.foldCode(l.Pos(n,0),{scanUp:!1},"fold")})},l.commands.unfoldAll=function(e){e.operation(function(){for(var n=e.firstLine(),t=e.lastLine();n<=t;n++)e.foldCode(l.Pos(n,0),{scanUp:!1},"unfold")})},l.registerHelper("fold","combine",function(){var e=Array.prototype.slice.call(arguments,0);return function(n,t){for(var f=0;f<e.length;++f){var i=e[f](n,t);if(i)return i}}}),l.registerHelper("fold","auto",function(e,n){for(var t=e.getHelpers(n,"fold"),f=0;f<t.length;f++){var i=t[f](e,n);if(i)return i}});var h={rangeFinder:l.fold.auto,widget:"\u2194",minFoldSize:0,scanUp:!1,clearOnEnter:!0};l.defineOption("foldOptions",null);function o(e,n,t){if(n&&n[t]!==void 0)return n[t];var f=e.options.foldOptions;return f&&f[t]!==void 0?f[t]:h[t]}l.defineExtension("foldOption",function(e,n){return o(this,e,n)})});
