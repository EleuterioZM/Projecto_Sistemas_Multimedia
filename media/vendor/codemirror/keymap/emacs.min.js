(function(c){typeof exports=="object"&&typeof module=="object"?c(require("../lib/codemirror")):typeof define=="function"&&define.amd?define(["../lib/codemirror"],c):c(CodeMirror)})(function(c){"use strict";var l=c.commands,f=c.Pos;function A(e,t){return e.line==t.line&&e.ch==t.ch}var d=[];function P(e){d.push(e),d.length>50&&d.shift()}function O(e){if(!d.length)return P(e);d[d.length-1]+=e}function U(e){return d[d.length-(e?Math.min(e,1):1)]||""}function j(){return d.length>1&&d.pop(),U()}var h=null;function w(e,t,r,n,a){a==null&&(a=e.getRange(t,r)),n=="grow"&&h&&h.cm==e&&A(t,h.pos)&&e.isClean(h.gen)?O(a):n!==!1&&P(a),e.replaceRange("",t,r,"+delete"),n=="grow"?h={cm:e,pos:t,gen:e.changeGeneration()}:h=null}function k(e,t,r){return e.findPosH(t,r,"char",!0)}function S(e,t,r){return e.findPosH(t,r,"word",!0)}function D(e,t,r){return e.findPosV(t,r,"line",e.doc.sel.goalColumn)}function K(e,t,r){return e.findPosV(t,r,"page",e.doc.sel.goalColumn)}function T(e,t,r){for(var n=t.line,a=e.getLine(n),i=/\S/.test(r<0?a.slice(0,t.ch):a.slice(t.ch)),o=e.firstLine(),C=e.lastLine();;){if(n+=r,n<o||n>C)return e.clipPos(f(n-r,r<0?0:null));a=e.getLine(n);var z=/\S/.test(a);if(z)i=!0;else if(i)return f(n,0)}}function b(e,t,r){for(var n=t.line,a=t.ch,i=e.getLine(t.line),o=!1;;){var C=i.charAt(a+(r<0?-1:0));if(!C){if(n==(r<0?e.firstLine():e.lastLine())||(i=e.getLine(n+r),!/\S/.test(i)))return f(n,a);n+=r,a=r<0?i.length:0;continue}if(o&&/[!?.]/.test(C))return f(n,a+(r>0?1:0));o||(o=/\w/.test(C)),a+=r}}function p(e,t,r){var n;if(e.findMatchingBracket&&(n=e.findMatchingBracket(t,{strict:!0}))&&n.match&&(n.forward?1:-1)==r)return r>0?f(n.to.line,n.to.ch+1):n.to;for(var a=!0;;a=!1){var i=e.getTokenAt(t),o=f(t.line,r<0?i.start:i.end);if(a&&r>0&&i.end==t.ch||!/\w/.test(i.string)){var C=e.findPosH(o,r,"char");if(A(o,C))return t;t=C}else return o}}function v(e,t){var r=e.state.emacsPrefix;return r?(L(e),r=="-"?-1:Number(r)):t?null:1}function s(e){var t=typeof e=="string"?function(r){r.execCommand(e)}:e;return function(r){var n=v(r);t(r);for(var a=1;a<n;++a)t(r)}}function R(e,t,r,n){var a=v(e);a<0&&(n=-n,a=-a);for(var i=0;i<a;++i){var o=r(e,t,n);if(A(o,t))break;t=o}return t}function u(e,t){var r=function(n){n.extendSelection(R(n,n.getCursor(),e,t))};return r.motion=!0,r}function g(e,t,r,n){for(var a=e.listSelections(),i,o=a.length;o--;)i=a[o].head,w(e,i,R(e,i,t,r),n)}function y(e,t){if(e.somethingSelected()){for(var r=e.listSelections(),n,a=r.length;a--;)n=r[a],w(e,n.anchor,n.head,t);return!0}}function X(e,t){if(e.state.emacsPrefix){t!="-"&&(e.state.emacsPrefix+=t);return}e.state.emacsPrefix=t,e.on("keyHandled",H),e.on("inputRead",F)}var B={"Alt-G":!0,"Ctrl-X":!0,"Ctrl-Q":!0,"Ctrl-U":!0};function H(e,t){!e.state.emacsPrefixMap&&!B.hasOwnProperty(t)&&L(e)}function L(e){e.state.emacsPrefix=null,e.off("keyHandled",H),e.off("inputRead",F)}function F(e,t){var r=v(e);if(r>1&&t.origin=="+input"){for(var n=t.text.join(`
`),a="",i=1;i<r;++i)a+=n;e.replaceSelection(a)}}function x(e,t){typeof t=="string"&&(/^\d$/.test(t)||t=="Ctrl-U")||(e.removeKeyMap(E),e.state.emacsPrefixMap=!1,e.off("keyHandled",x),e.off("inputRead",x))}l.setMark=function(e){e.setCursor(e.getCursor()),e.setExtending(!e.getExtending()),e.on("change",function(){e.setExtending(!1)})};function G(e){e.setExtending(!1),e.setCursor(e.getCursor())}function I(e){var t=document.createDocumentFragment(),r=document.createElement("input");return r.setAttribute("type","text"),r.style.width="10em",t.appendChild(document.createTextNode(e+": ")),t.appendChild(r),t}function q(e,t,r){e.openDialog?e.openDialog(I(t),r,{bottom:!0}):r(prompt(t,""))}function W(e,t){var r=e.getCursor(),n=e.findPosH(r,1,"word");e.replaceRange(t(e.getRange(r,n)),r,n),e.setCursor(n)}function Q(e){for(var t=e.getCursor(),r=t.line,n=t.ch,a=[];r>=e.firstLine();){for(var i=e.getLine(r),o=n??i.length;o>0;){var n=i.charAt(--o);if(n==")")a.push("(");else if(n=="]")a.push("[");else if(n=="}")a.push("{");else if(/[\(\{\[]/.test(n)&&(!a.length||a.pop()!=n))return e.extendSelection(f(r,o))}--r,n=null}}l.killRegion=function(e){w(e,e.getCursor("start"),e.getCursor("end"),!0)},l.killLineEmacs=s(function(e){var t=e.getCursor(),r=e.clipPos(f(t.line)),n=e.getRange(t,r);/\S/.test(n)||(n+=`
`,r=f(t.line+1,0)),w(e,t,r,"grow",n)}),l.killRingSave=function(e){P(e.getSelection()),G(e)},l.yank=function(e){var t=e.getCursor();e.replaceRange(U(v(e)),t,t,"paste"),e.setSelection(t,e.getCursor())},l.yankPop=function(e){e.replaceSelection(j(),"around","paste")},l.forwardChar=u(k,1),l.backwardChar=u(k,-1),l.deleteChar=function(e){g(e,k,1,!1)},l.deleteForwardChar=function(e){y(e,!1)||g(e,k,1,!1)},l.deleteBackwardChar=function(e){y(e,!1)||g(e,k,-1,!1)},l.forwardWord=u(S,1),l.backwardWord=u(S,-1),l.killWord=function(e){g(e,S,1,"grow")},l.backwardKillWord=function(e){g(e,S,-1,"grow")},l.nextLine=u(D,1),l.previousLine=u(D,-1),l.scrollDownCommand=u(K,-1),l.scrollUpCommand=u(K,1),l.backwardParagraph=u(T,-1),l.forwardParagraph=u(T,1),l.backwardSentence=u(b,-1),l.forwardSentence=u(b,1),l.killSentence=function(e){g(e,b,1,"grow")},l.backwardKillSentence=function(e){w(e,e.getCursor(),b(e,e.getCursor(),1),"grow")},l.killSexp=function(e){g(e,p,1,"grow")},l.backwardKillSexp=function(e){g(e,p,-1,"grow")},l.forwardSexp=u(p,1),l.backwardSexp=u(p,-1),l.markSexp=function(e){var t=e.getCursor();e.setSelection(R(e,t,p,1),t)},l.transposeSexps=function(e){var t=p(e,e.getCursor(),-1),r=p(e,t,1),n=p(e,r,1),a=p(e,n,-1);e.replaceRange(e.getRange(a,n)+e.getRange(r,a)+e.getRange(t,r),t,n)},l.backwardUpList=s(Q),l.justOneSpace=function(e){for(var t=e.getCursor(),r=t.ch,n=t.ch,a=e.getLine(t.line);r&&/\s/.test(a.charAt(r-1));)--r;for(;n<a.length&&/\s/.test(a.charAt(n));)++n;e.replaceRange(" ",f(t.line,r),f(t.line,n))},l.openLine=s(function(e){e.replaceSelection(`
`,"start")}),l.transposeCharsRepeatable=s(function(e){e.execCommand("transposeChars")}),l.capitalizeWord=s(function(e){W(e,function(t){var r=t.search(/\w/);return r==-1?t:t.slice(0,r)+t.charAt(r).toUpperCase()+t.slice(r+1).toLowerCase()})}),l.upcaseWord=s(function(e){W(e,function(t){return t.toUpperCase()})}),l.downcaseWord=s(function(e){W(e,function(t){return t.toLowerCase()})}),l.undoRepeatable=s("undo"),l.keyboardQuit=function(e){e.execCommand("clearSearch"),G(e)},l.newline=s(function(e){e.replaceSelection(`
`,"end")}),l.gotoLine=function(e){var t=v(e,!0);if(t!=null&&t>0)return e.setCursor(t-1);q(e,"Goto line",function(r){var n;r&&!isNaN(n=Number(r))&&n==(n|0)&&n>0&&e.setCursor(n-1)})},l.indentRigidly=function(e){e.indentSelection(v(e,!0)||e.getOption("indentUnit"))},l.exchangePointAndMark=function(e){e.setSelection(e.getCursor("head"),e.getCursor("anchor"))},l.quotedInsertTab=s("insertTab"),l.universalArgument=function(t){t.state.emacsPrefixMap=!0,t.addKeyMap(E),t.on("keyHandled",x),t.on("inputRead",x)},c.emacs={kill:w,killRegion:y,repeated:s};var V=c.keyMap.emacs=c.normalizeKeyMap({"Ctrl-W":"killRegion","Ctrl-K":"killLineEmacs","Alt-W":"killRingSave","Ctrl-Y":"yank","Alt-Y":"yankPop","Ctrl-Space":"setMark","Ctrl-Shift-2":"setMark","Ctrl-F":"forwardChar","Ctrl-B":"backwardChar",Right:"forwardChar",Left:"backwardChar","Ctrl-D":"deleteChar",Delete:"deleteForwardChar","Ctrl-H":"deleteBackwardChar",Backspace:"deleteBackwardChar","Alt-F":"forwardWord","Alt-B":"backwardWord","Alt-Right":"forwardWord","Alt-Left":"backwardWord","Alt-D":"killWord","Alt-Backspace":"backwardKillWord","Ctrl-N":"nextLine","Ctrl-P":"previousLine",Down:"nextLine",Up:"previousLine","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd",End:"goLineEnd",Home:"goLineStart","Alt-V":"scrollDownCommand","Ctrl-V":"scrollUpCommand",PageUp:"scrollDownCommand",PageDown:"scrollUpCommand","Ctrl-Up":"backwardParagraph","Ctrl-Down":"forwardParagraph","Alt-{":"backwardParagraph","Alt-}":"forwardParagraph","Alt-A":"backwardSentence","Alt-E":"forwardSentence","Alt-K":"killSentence","Ctrl-X Delete":"backwardKillSentence","Ctrl-Alt-K":"killSexp","Ctrl-Alt-Backspace":"backwardKillSexp","Ctrl-Alt-F":"forwardSexp","Ctrl-Alt-B":"backwardSexp","Shift-Ctrl-Alt-2":"markSexp","Ctrl-Alt-T":"transposeSexps","Ctrl-Alt-U":"backwardUpList","Alt-Space":"justOneSpace","Ctrl-O":"openLine","Ctrl-T":"transposeCharsRepeatable","Alt-C":"capitalizeWord","Alt-U":"upcaseWord","Alt-L":"downcaseWord","Alt-;":"toggleComment","Ctrl-/":"undoRepeatable","Shift-Ctrl--":"undoRepeatable","Ctrl-Z":"undoRepeatable","Cmd-Z":"undoRepeatable","Ctrl-X U":"undoRepeatable","Shift-Ctrl-Z":"redo","Shift-Alt-,":"goDocStart","Shift-Alt-.":"goDocEnd","Ctrl-S":"findPersistentNext","Ctrl-R":"findPersistentPrev","Ctrl-G":"keyboardQuit","Shift-Alt-5":"replace","Alt-/":"autocomplete",Enter:"newlineAndIndent","Ctrl-J":"newline",Tab:"indentAuto","Alt-G G":"gotoLine","Ctrl-X Tab":"indentRigidly","Ctrl-X Ctrl-X":"exchangePointAndMark","Ctrl-X Ctrl-S":"save","Ctrl-X Ctrl-W":"save","Ctrl-X S":"saveAll","Ctrl-X F":"open","Ctrl-X K":"close","Ctrl-X H":"selectAll","Ctrl-Q Tab":"quotedInsertTab","Ctrl-U":"universalArgument",fallthrough:"default"}),E={"Ctrl-G":L};function N(e){E[e]=function(t){X(t,e)},V["Ctrl-"+e]=function(t){X(t,e)},B["Ctrl-"+e]=!0}for(var M=0;M<10;++M)N(String(M));N("-")});
