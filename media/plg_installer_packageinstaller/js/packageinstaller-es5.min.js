(function(){"use strict";/**
 * @copyright   (C) 2020 Open Source Matters, Inc. <https://www.joomla.org>
 * @license     GNU General Public License version 2 or later; see LICENSE.txt
 */Joomla=window.Joomla||{},function(t){document.addEventListener("DOMContentLoaded",function(){if(t.submitbuttonpackage=function(){var e=document.getElementById("adminForm");if(e.install_package.value==="")t.renderMessages({warning:[t.Text._("PLG_INSTALLER_PACKAGEINSTALLER_NO_PACKAGE")]});else if(e.install_package.files[0].size>e.max_upload_size.value)t.renderMessages({warning:[t.Text._("COM_INSTALLER_MSG_WARNINGS_UPLOADFILETOOBIG")]});else{var n=document.getElementById("loading");n&&n.classList.remove("hidden"),e.installtype.value="upload",e.submit()}},typeof FormData>"u"){document.querySelector("#legacy-uploader").classList.remove("hidden"),document.querySelector("#uploader-wrapper").classList.add("hidden");return}var u=!1,a=document.querySelector("#dragarea"),f=document.querySelector("#install_package"),E=document.querySelector("#max_upload_size").value,A=document.querySelector("#select-file-button"),g=document.querySelector("#installer-return").value,L=document.getElementById("upload-progress"),l=L.querySelector(".progress-bar"),v=L.querySelector(".uploading-number"),_="index.php?option=com_installer&task=install.ajax_upload";function o(e){a.setAttribute("data-state","pending");var n=t.Text._("PLG_INSTALLER_PACKAGEINSTALLER_UPLOAD_ERROR_UNKNOWN");e==null?n=t.Text._("PLG_INSTALLER_PACKAGEINSTALLER_UPLOAD_ERROR_EMPTY"):typeof e=="string"?n=e.replace(/(<([^>]+)>|\s+)/g," "):e.message&&(n=e.message),t.renderMessages({error:[n]})}g&&(_+="&return="+g),A.addEventListener("click",function(){f.click()}),f.addEventListener("change",function(){u||t.submitbuttonpackage()}),a.addEventListener("dragenter",function(e){return e.preventDefault(),e.stopPropagation(),a.classList.add("hover"),!1}),a.addEventListener("dragover",function(e){return e.preventDefault(),e.stopPropagation(),a.classList.add("hover"),!1}),a.addEventListener("dragleave",function(e){return e.preventDefault(),e.stopPropagation(),a.classList.remove("hover"),!1}),a.addEventListener("drop",function(e){if(e.preventDefault(),e.stopPropagation(),!u){a.classList.remove("hover");var n=e.target.files||e.dataTransfer.files;if(n.length){var d=n[0],c=new FormData;if(!d.type){t.renderMessages({error:[t.Text._("PLG_INSTALLER_PACKAGEINSTALLER_NO_PACKAGE")]});return}if(d.size>E){t.renderMessages({warning:[t.Text._("COM_INSTALLER_MSG_WARNINGS_UPLOADFILETOOBIG")]});return}c.append("install_package",d),c.append("installtype","upload"),a.setAttribute("data-state","uploading"),l.setAttribute("aria-valuenow",0),u=!0,l.style.width=0,v.textContent="0";var S=function(r){if(r.lengthComputable){var s=r.loaded/r.total,i=Math.round(s*100);l.style.width=i+"%",l.setAttribute("aria-valuenow",i),v.textContent=""+i,i===100&&a.setAttribute("data-state","installing")}};t.request({url:_,method:"POST",perform:!0,data:c,onBefore:function(r){r.upload.addEventListener("progress",S)},onSuccess:function(r){if(!r){o(r);return}var s;try{s=JSON.parse(r)}catch(i){o(i);return}if(!s.success&&!s.data){o(s);return}s.data.redirect?window.location.href=s.data.redirect:window.location.href="index.php?option=com_installer&view=install"},onError:function(r){if(u=!1,r.status===200){var s=r.responseText||r.responseJSON;o(s)}else o(r.statusText)}})}}}),document.getElementById("installbutton_package").addEventListener("click",function(e){e.preventDefault(),t.submitbuttonpackage()})})}(Joomla)})();
