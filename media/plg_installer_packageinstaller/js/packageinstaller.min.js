/**
 * @copyright   (C) 2020 Open Source Matters, Inc. <https://www.joomla.org>
 * @license     GNU General Public License version 2 or later; see LICENSE.txt
 */Joomla=window.Joomla||{},(t=>{document.addEventListener("DOMContentLoaded",()=>{if(t.submitbuttonpackage=()=>{const e=document.getElementById("adminForm");if(e.install_package.value==="")t.renderMessages({warning:[t.Text._("PLG_INSTALLER_PACKAGEINSTALLER_NO_PACKAGE")]});else if(e.install_package.files[0].size>e.max_upload_size.value)t.renderMessages({warning:[t.Text._("COM_INSTALLER_MSG_WARNINGS_UPLOADFILETOOBIG")]});else{const n=document.getElementById("loading");n&&n.classList.remove("hidden"),e.installtype.value="upload",e.submit()}},typeof FormData>"u"){document.querySelector("#legacy-uploader").classList.remove("hidden"),document.querySelector("#uploader-wrapper").classList.add("hidden");return}let o=!1;const a=document.querySelector("#dragarea"),p=document.querySelector("#install_package"),E=document.querySelector("#max_upload_size").value,A=document.querySelector("#select-file-button"),g=document.querySelector("#installer-return").value,f=document.getElementById("upload-progress"),d=f.querySelector(".progress-bar"),L=f.querySelector(".uploading-number");let _="index.php?option=com_installer&task=install.ajax_upload";function l(e){a.setAttribute("data-state","pending");let n=t.Text._("PLG_INSTALLER_PACKAGEINSTALLER_UPLOAD_ERROR_UNKNOWN");e==null?n=t.Text._("PLG_INSTALLER_PACKAGEINSTALLER_UPLOAD_ERROR_EMPTY"):typeof e=="string"?n=e.replace(/(<([^>]+)>|\s+)/g," "):e.message&&({message:n}=e),t.renderMessages({error:[n]})}g&&(_+=`&return=${g}`),A.addEventListener("click",()=>{p.click()}),p.addEventListener("change",()=>{o||t.submitbuttonpackage()}),a.addEventListener("dragenter",e=>(e.preventDefault(),e.stopPropagation(),a.classList.add("hover"),!1)),a.addEventListener("dragover",e=>(e.preventDefault(),e.stopPropagation(),a.classList.add("hover"),!1)),a.addEventListener("dragleave",e=>(e.preventDefault(),e.stopPropagation(),a.classList.remove("hover"),!1)),a.addEventListener("drop",e=>{if(e.preventDefault(),e.stopPropagation(),o)return;a.classList.remove("hover");const n=e.target.files||e.dataTransfer.files;if(!n.length)return;const u=n[0],c=new FormData;if(!u.type){t.renderMessages({error:[t.Text._("PLG_INSTALLER_PACKAGEINSTALLER_NO_PACKAGE")]});return}if(u.size>E){t.renderMessages({warning:[t.Text._("COM_INSTALLER_MSG_WARNINGS_UPLOADFILETOOBIG")]});return}c.append("install_package",u),c.append("installtype","upload"),a.setAttribute("data-state","uploading"),d.setAttribute("aria-valuenow",0),o=!0,d.style.width=0,L.textContent="0";const m=r=>{if(r.lengthComputable){const s=r.loaded/r.total,i=Math.round(s*100);d.style.width=`${i}%`,d.setAttribute("aria-valuenow",i),L.textContent=`${i}`,i===100&&a.setAttribute("data-state","installing")}};t.request({url:_,method:"POST",perform:!0,data:c,onBefore:r=>{r.upload.addEventListener("progress",m)},onSuccess:r=>{if(!r){l(r);return}let s;try{s=JSON.parse(r)}catch(i){l(i);return}if(!s.success&&!s.data){l(s);return}s.data.redirect?window.location.href=s.data.redirect:window.location.href="index.php?option=com_installer&view=install"},onError:r=>{if(o=!1,r.status===200){const s=r.responseText||r.responseJSON;l(s)}else l(r.statusText)}})}),document.getElementById("installbutton_package").addEventListener("click",e=>{e.preventDefault(),t.submitbuttonpackage()})})})(Joomla);
