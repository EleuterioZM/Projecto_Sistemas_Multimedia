(function(){"use strict";tinymce.PluginManager.add("jdragndrop",function(t){var m=function(a){if(a.dataTransfer.types.includes("Files"))return a.stopPropagation(),a.preventDefault(),t.contentAreaContainer.style.borderWidth="0",!1};tinyMCE.DOM.bind(document,"dragleave",m),t.on("remove",function(){tinyMCE.DOM.unbind(document,"dragleave",m)}),t.on("dragenter",function(a){if(a.dataTransfer.types.includes("Files"))return a.stopPropagation(),!1}),t.on("dragover",function(a){if(a.dataTransfer.types.includes("Files"))return a.preventDefault(),t.contentAreaContainer.style.borderStyle="dashed",t.contentAreaContainer.style.borderWidth="5px",!1});function v(a,n){var e,o=t.settings.uploadUri+"&path="+t.settings.comMediaAdapter+t.settings.parentUploadFolder,c=(e={},e[t.settings.csrfToken]="1",e.name=a,e.content=n,e.parent=t.settings.parentUploadFolder,e);Joomla.request({url:o,method:"POST",data:JSON.stringify(c),headers:{"Content-Type":"application/json"},onSuccess:function(d){var i;try{i=JSON.parse(d)}catch{t.windowManager.alert(Joomla.Text._("ERROR")+": {e}")}if(i.data&&i.data.path){var s=i.data,p,h=Joomla.getOptions("system.paths"),b=h.rootFull,g=i.data.url.split(b);g.length>1?p=""+g[1]:s.url&&(p=s.url);var y=function(r){var l=r.getData(),D=l.altEmpty?' alt=""':"",_=l.altText?' alt="'+l.altText+'"':D,x=l.isLazy?' loading="lazy"':"",L=l.isLazy?' width="'+s.width+'"':"",A=l.isLazy?' height="'+s.height+'"':"";t.execCommand("mceInsertContent",!1,'<img src="'+p+'"'+_+x+L+A+"/>")};t.windowManager.open({title:Joomla.Text._("PLG_TINY_DND_ADDITIONALDATA"),body:{type:"panel",items:[{type:"input",name:"altText",label:Joomla.Text._("PLG_TINY_DND_ALTTEXT")},{type:"checkbox",name:"altEmpty",label:Joomla.Text._("PLG_TINY_DND_EMPTY_ALT")},{type:"checkbox",name:"isLazy",label:Joomla.Text._("PLG_TINY_DND_LAZYLOADED")}]},buttons:[{type:"cancel",text:"Cancel"},{type:"submit",name:"submitButton",text:"Save",primary:!0}],initialData:{altText:"",isLazy:!0,altEmpty:!1},onSubmit:function(r){y(r),r.close()},onCancel:function(r){y(r)}})}},onError:function(d){t.windowManager.alert("Error: "+d.statusText)}})}function T(a){var n=new FileReader;n.onload=function(e){var o=e.target.result,c=o.indexOf("base64")+7,u=o.slice(c,o.length);v(a.name,u)},n.readAsDataURL(a)}t.on("drop",function(a){if(a.dataTransfer.types.includes("Files")){if(a.preventDefault(),a.dataTransfer.files.length>0){var n=[].slice.call(a.dataTransfer.files);n.forEach(function(e){e.name.toLowerCase().match(/\.(jpg|jpeg|png|gif|webp)$/)&&T(e)})}t.contentAreaContainer.style.borderWidth="0"}})})})();
