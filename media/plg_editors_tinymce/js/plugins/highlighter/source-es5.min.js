(function(){"use strict";if(!window.parent.Joomla||typeof window.parent.Joomla.getOptions!="function")throw new Error("Joomla API not found");var C=window.parent.Joomla.getOptions("system.paths").rootFull,o=C+"/media/vendor/codemirror",s={indentOnInit:!0,config:{mode:"htmlmixed",theme:"default",lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2,indentWithTabs:!0,matchBrackets:!0,saveCursorPosition:!0,styleActiveLine:!0},jsFiles:[o+"/lib/codemirror.min.js",o+"/addon/edit/matchbrackets.min.js",o+"/mode/xml/xml.min.js",o+"/mode/javascript/javascript.min.js",o+"/mode/css/css.min.js",o+"/mode/htmlmixed/htmlmixed.min.js",o+"/addon/dialog/dialog.min.js",o+"/addon/search/searchcursor.min.js",o+"/addon/search/search.min.js",o+"/addon/selection/active-line.min.js"],cssFiles:[o+"/lib/codemirror.css",o+"/addon/dialog/dialog.css"]},l,i,m,g=0,f=/macintosh|mac os/i.test(navigator.userAgent),y=function(t){return new Promise(function(a,c){var e=document.createElement("script");e.src=t,e.onload=function(){return a()},e.onerror=function(){return c(new Error("Failed to load the script "+t))},document.head.appendChild(e)})},E=function(t,a){for(var c=t.indexOf(a),e=0,d=c-1;d>=0;d-=1)switch(t.charAt(d)){case"<":e-=1;break;case">":e+=1;break;case"&":e+=1;break}return e};window.tinymceHighlighterSubmit=function(){var r="&#x0;",t=m,a=t.isDirty,c=m,e=c.doc;e.somethingSelected()&&e.setCursor(e.getCursor()),e.replaceSelection(r);var d=m.getCursor(),n=e.getLine(d.line);E(n,r)!==0&&(n=n.replace(r,""),e.replaceRange(n,window.CodeMirror.Pos(d.line,0),window.CodeMirror.Pos(d.line)));var u=m.getValue(),v=new RegExp("<script(.*?)>(.*?)"+r+"(.*?)<\/script>","ms"),p=new RegExp("<style(.*?)>(.*?)"+r+"(.*?)</style>","ms"),b=new RegExp("<[^>]*("+r+").*>|^("+r+")|("+r+")$");u.search(v)!==-1||u.search(p)!==-1||u.search(b)!==-1?i.setContent(u.replace(r,"")):i.setContent(u.replace(r,'<span id="CmCaReT"></span>')),i.isNotDirty=!a,a&&i.nodeChanged();var h=i.dom.select("span#CmCaReT")[0];h&&(i.selection.scrollIntoView(h),i.selection.setCursorLocation(h,0),i.dom.remove(h))},document.addEventListener("keydown",function(r){var t=r||window.event,a=!1;"key"in t?a=t.key==="Escape"||t.key==="Esc":a=t.keyCode===27,a&&l.activeEditor.windowManager.close()});var S=function(){if(typeof window.CodeMirror!="function")throw new Error('CodeMirror not found in "'+s.path+'", aborting...');var t=window.parent.document.querySelectorAll(".tox-dialog__footer")[0],a=window.parent.document.createElement("div"),c='<td style="font-size:11px;background:#777;color:#fff;padding:0 4px">',e='<td style="font-size:11px;padding-right:5px">';a.innerHTML=`
<table cellspacing="0" cellpadding="0" style="border-spacing:4px">
  <tr>
    `+c+(f?"&#8984;-F":"Ctrl-F</td>")+e+l.translate("Start search")+`</td>
    `+c+(f?"&#8984;-G":"Ctrl-G")+`</td>
    `+e+l.translate("Find next")+`</td>
    `+c+(f?"&#8984;-Alt-F":"Shift-Ctrl-F")+`</td>
    `+e+l.translate("Find previous")+`</td>
  </tr>
  <tr>
    `+c+(f?"&#8984;-Alt-F":"Shift-Ctrl-F")+`</td>
    `+e+l.translate("Replace")+`</td>
    `+c+(f?"Shift-&#8984;-Alt-F":"Shift-Ctrl-R")+`</td>
    `+e+l.translate("Replace all")+`</td>
  </tr>
</table>`,t.insertAdjacentElement("afterbegin",a);var d=i.getContent({source_view:!0});d=d.replace(/<span\s+style="display: none;"\s+class="CmCaReT"([^>]*)>([^<]*)<\/span>/gm,String.fromCharCode(g)),i.dom.remove(i.dom.select(".CmCaReT")),l.each(i.contextToolbars,function(n){n.panel&&n.panel.hide()}),window.CodeMirror.defineInitHook(function(n){n.focus();var u=n.getSearchCursor(String.fromCharCode(g),!1);if(u.findNext()&&(n.setCursor(u.to()),u.replace("")),i.settings.codemirror.indentOnInit){var v=n.lineCount();n.operation(function(){for(var p=0;p<v;++p)n.indentLine(p)})}}),s.config.value=d,m=window.CodeMirror(document.body,s.config),m.isDirty=!1,m.on("change",function(n){n.isDirty=!0}),m.setSize("100%","100%"),m.refresh()};if(l=window.parent.tinymce,!l)throw new Error("tinyMCE not found");i=l.activeEditor;var w=i.settings.codemirror;w.fullscreen&&(s.jsFiles.push(o+"/addon/display/fullscreen.min.js"),s.cssFiles.push(o+"/addon/display/fullscreen.css")),s=Object.assign({},s,w),s.cssFiles.forEach(function(r){var t=document.createElement("link");t.rel="stylesheet",t.href=r,document.head.appendChild(t)}),s.jsFiles.reduce(function(r,t){return r.then(function(){return y(t)})},Promise.resolve(!0)).then(function(){s.config.theme&&(document.documentElement.className+=s.config.theme.replace(/(^|\s)\s*/g," cm-s-")),S()})})();
