(function(){"use strict";/**
 * @copyright  (C) 2018 Open Source Matters, Inc. <https://www.joomla.org>
 * @license    GNU General Public License version 2 or later; see LICENSE.txt
 */var o=!1,c=function(a,e){var t=document.createElement("canvas");a>=0&&a<45||a>=135&&a<225||a>=315&&a<=360?(t.width=e.naturalWidth,t.height=e.naturalHeight):(t.width=e.naturalHeight,t.height=e.naturalWidth);var n=t.getContext("2d");n.clearRect(0,0,t.width,t.height),n.translate(t.width/2,t.height/2),n.rotate(a*Math.PI/180),n.drawImage(e,-e.naturalWidth/2,-e.naturalHeight/2);var r=Joomla.MediaManager.Edit.original.extension==="jpg"?"jpeg":"jpg",l=document.getElementById("jform_rotate_quality").value;Joomla.MediaManager.Edit.current.contents=t.toDataURL("image/"+r,l),e.width=t.width,e.height=t.height,e.src="",requestAnimationFrame(function(){return requestAnimationFrame(function(){e.src=Joomla.MediaManager.Edit.current.contents})}),document.getElementById("jform_rotate_a").value=a,window.dispatchEvent(new Event("mediaManager.history.point")),t=null},u=function(a){o||(document.getElementById("jform_rotate_a").addEventListener("change",function(e){var t=e.target;c(parseInt(t.value,10),a),t.value=0,[].slice.call(document.querySelectorAll("#jform_rotate_distinct label")).forEach(function(n){n.classList.remove("active"),n.classList.remove("focus")})}),[].slice.call(document.querySelectorAll("#jform_rotate_distinct [type=radio]")).forEach(function(e){e.addEventListener("click",function(t){var n=t.target;c(parseInt(n.value,10),a),[].slice.call(document.querySelectorAll("#jform_rotate_distinct label")).forEach(function(r){r.classList.remove("active"),r.classList.remove("focus")})})}),o=!0)};window.addEventListener("media-manager-edit-init",function(){Joomla.MediaManager.Edit.plugins.rotate={Activate:function(a){return new Promise(function(e){u(a),e()})},Deactivate:function(){return new Promise(function(a){a()})}}},{once:!0})})();
