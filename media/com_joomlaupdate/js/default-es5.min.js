(function(){"use strict";/**
 * @copyright   (C) 2012 Open Source Matters, Inc. <https://www.joomla.org>
 * @license     GNU General Public License version 2 or later; see LICENSE.txt
 */Joomla=window.Joomla||{},function(r,i){r.submitbuttonUpload=function(){var t=i.getElementById("uploadForm"),a=i.getElementById("joomlaupdate-confirm-backup");t.install_package.value===""?alert(r.Text._("COM_INSTALLER_MSG_INSTALL_PLEASE_SELECT_A_PACKAGE"),!0):t.install_package.files[0].size>t.max_upload_size.value?alert(r.Text._("COM_INSTALLER_MSG_WARNINGS_UPLOADFILETOOBIG"),!0):a&&a.checked&&t.submit()},r.installpackageChange=function(){var t=i.getElementById("uploadForm"),a=t.install_package.files[0].size,n=a*1/1024/1024,l=i.getElementById("file_size"),s=i.getElementById("max_upload_size_warn");t.install_package.value===""?(l.classList.add("hidden"),s.classList.add("hidden")):a&&(l.classList.remove("hidden"),l.innerHTML=r.sanitizeHtml(r.Text._("JGLOBAL_SELECTED_UPLOAD_FILE_SIZE").replace("%s",n.toFixed(2)+" MB")),a>t.max_upload_size.value?s.classList.remove("hidden"):s.classList.add("hidden"))},i.addEventListener("DOMContentLoaded",function(){var t=i.getElementById("confirmButton"),a=i.getElementById("uploadForm"),n=i.getElementById("uploadButton"),l=i.getElementById("install_package"),s=i.querySelector(".emptystate-btnadd",i.getElementById("joomlaupdate-wrapper")),e=i.getElementById("joomlaupdate-confirm-backup"),c=s?s.closest("form"):null,o=c?c.querySelector("[name=task]",c):null;n&&(n.addEventListener("click",r.submitbuttonUpload),n.disabled=e&&!e.checked,e&&e.addEventListener("change",function(){n.disabled=!e.checked})),t&&e&&!e.checked&&t.classList.add("disabled"),t&&e&&e.addEventListener("change",function(){e.checked?t.classList.remove("disabled"):t.classList.add("disabled")}),l&&(l.addEventListener("change",r.installpackageChange),e&&l.addEventListener("change",function(){var d=a.install_package.files[0].size,E=a.max_upload_size.value;d<=E&&e.disabled?e.disabled=!e.disabled:d<=E&&!e.disabled&&!e.checked?e.disabled=!1:d<=E&&e.checked?(e.checked=e.classList.contains("d-none"),n.disabled=!0):d>E&&!e.disabled&&(e.disabled=!e.disabled,e.checked=e.classList.contains("d-none"),n.disabled=!0)})),s&&s.getAttribute("href")==="#"&&o&&s.addEventListener("click",function(d){d.preventDefault(),!(e&&!e.checked)&&(o.value="update.download",c.submit())})})}(Joomla,document),function(r,i){var t={};t.config={serverUrl:"index.php?option=com_joomlaupdate&task=update.fetchextensioncompatibility",batchUrl:"index.php?option=com_joomlaupdate&task=update.batchextensioncompatibility",selector:".extension-check"},t.STATE={INCOMPATIBLE:0,COMPATIBLE:1,MISSING_COMPATIBILITY_TAG:2,SERVER_ERROR:3},t.cleanup=function(a){var n=i.querySelector("#joomlaupdate-precheck-extensions-tab .fa-spinner"),l="success",s="check";switch(a){case"danger":l="danger",s="times";break;case"warning":l="warning",s="exclamation-triangle";break}n&&(n.classList.remove("fa-spinner","fa-spin"),n.classList.add("fa-"+s,"text-"+l,"bg-white"));var e=i.querySelector("#compatibilityTable0"),c=i.querySelector("#preupdateCheckWarning");e&&e.classList.add("hidden"),c&&c.classList.add("hidden")},t.run=function(){t.nonCoreCriticalPlugins=r.getOptions("nonCoreCriticalPlugins",[]);var a=i.querySelectorAll(t.config.selector);if(a.length===0){i.getElementById("preupdatecheckbox")!==null&&(i.getElementById("preupdatecheckbox").style.display="none"),i.getElementById("noncoreplugins")!==null&&(i.getElementById("noncoreplugins").checked=!0),[].slice.call(i.querySelectorAll("button.submitupdate")).forEach(function(e){e.classList.remove("disabled"),e.removeAttribute("disabled")}),t.cleanup();return}var n=function(){var c=i.getElementById("noncoreplugins");c.checked?window.confirm(r.Text._("COM_JOOMLAUPDATE_VIEW_DEFAULT_POTENTIALLY_DANGEROUS_PLUGIN_CONFIRM_MESSAGE"))?[].slice.call(i.querySelectorAll("button.submitupdate")).forEach(function(o){o.classList.remove("disabled"),o.removeAttribute("disabled")}):c.checked=!1:[].slice.call(i.querySelectorAll("button.submitupdate")).forEach(function(o){o.classList.add("disabled"),o.setAttribute("disabled","")})};i.getElementById("noncoreplugins")!==null&&i.getElementById("noncoreplugins").addEventListener("change",n);var l=i.getElementById("joomlaupdate-wrapper");t.joomlaTargetVersion=l.getAttribute("data-joomla-target-version"),t.joomlaCurrentVersion=l.getAttribute("data-joomla-current-version"),[].slice.call(i.querySelectorAll(".compatibilitytoggle")).forEach(function(e){e.addEventListener("click",function(){var c=e.closest(".compatibilityTable");e.dataset.state==="closed"?(e.dataset.state="open",e.innerHTML=r.sanitizeHtml(r.Text._("COM_JOOMLAUPDATE_VIEW_DEFAULT_EXTENSIONS_SHOW_LESS_COMPATIBILITY_INFORMATION")),[].slice.call(c.querySelectorAll("table .hidden")).forEach(function(o){o.classList.remove("hidden")})):(e.dataset.state="closed",e.innerHTML=r.sanitizeHtml(r.Text._("COM_JOOMLAUPDATE_VIEW_DEFAULT_EXTENSIONS_SHOW_MORE_COMPATIBILITY_INFORMATION")),[].slice.call(c.querySelectorAll("table .instver, table .upcomp, table .currcomp")).forEach(function(o){o.classList.add("hidden")}))})});var s=[];[].slice.call(a).forEach(function(e){var c={eid:e.getAttribute("data-extension-id"),version:e.getAttribute("data-extension-current-version")};s.push(c)}),t.checkNextChunk(s)},t.interpolateParameters=function(a,n){var l="";return typeof a!="object"||a===null||!a?"":(Object.keys(a).forEach(function(s){var e=a[s];if(l.length>0&&(l+="&"),typeof e=="object"){var c=n.length?n+"["+s+"]":s;l+=t.interpolateParameters(e,c);return}if(n===""){l+=encodeURIComponent(s)+"="+encodeURIComponent(e);return}l+=encodeURIComponent(n)+"["+encodeURIComponent(s)+"]="+encodeURIComponent(e)}),l)},t.checkNextChunk=function(a){a.length!==0&&r.request({url:t.config.batchUrl,method:"POST",data:t.interpolateParameters({"joomla-target-version":t.joomlaTargetVersion,"joomla-current-version":t.joomlaCurrentVersion,extensions:a},""),onSuccess:function(l){var s=JSON.parse(l);s.messages&&r.renderMessages(s.messages);var e=s.data.extensions||[];s.data.compatibility.forEach(function(c){var o=i.getElementById("preUpdateCheck_"+c.id);o&&t.setResultView({element:o,compatibleVersion:0,serverError:0,compatibilityData:c})}),t.checkNextChunk(e)},onError:function(l){r.renderMessages(r.ajaxErrorsMessages(l)),a.forEach(function(s){var e=i.getElementById("preUpdateCheck_"+s.eid);e&&t.setResultView({element:e,compatibleVersion:0,serverError:1})})}})},t.checkCompatibility=function(a){var n={element:a,compatibleVersion:0,serverError:1};r.request({url:t.config.serverUrl+"&joomla-target-version="+encodeURIComponent(t.joomlaTargetVersion)+"&joomla-current-version="+t.joomlaCurrentVersion+"&extension-version="+a.getAttribute("data-extension-current-version")+"&extension-id="+encodeURIComponent(a.getAttribute("data-extension-id")),onSuccess:function(s){var e=JSON.parse(s);n.serverError=0,n.compatibilityData=e.data,t.setResultView(n)},onError:function(){n.serverError=1,t.setResultView(n)}})},t.setResultView=function(a){var n="";if(a.serverError)n=r.Text._("COM_JOOMLAUPDATE_VIEW_DEFAULT_EXTENSION_SERVER_ERROR"),a.compatibilityData={resultGroup:4};else switch(a.compatibilityData.upgradeCompatibilityStatus.state){case t.STATE.COMPATIBLE:if(a.compatibilityData.upgradeWarning){var l=r.sanitizeHtml(a.compatibilityData.upgradeCompatibilityStatus.compatibleVersion);n='<span class="label label-warning">'+l+"</span>"}else n=a.compatibilityData.upgradeCompatibilityStatus.compatibleVersion===!1?r.Text._("COM_JOOMLAUPDATE_VIEW_DEFAULT_EXTENSION_NO_COMPATIBILITY_INFORMATION"):r.sanitizeHtml(a.compatibilityData.upgradeCompatibilityStatus.compatibleVersion);break;case t.STATE.INCOMPATIBLE:n=r.Text._("COM_JOOMLAUPDATE_VIEW_DEFAULT_EXTENSION_NO_COMPATIBILITY_INFORMATION");break;case t.STATE.MISSING_COMPATIBILITY_TAG:n=r.Text._("COM_JOOMLAUPDATE_VIEW_DEFAULT_EXTENSION_NO_COMPATIBILITY_INFORMATION");break;default:n=r.Text._("COM_JOOMLAUPDATE_VIEW_DEFAULT_EXTENSION_WARNING_UNKNOWN")}if(a.element.innerHTML=n,n="",a.serverError)n=r.Text._("COM_JOOMLAUPDATE_VIEW_DEFAULT_EXTENSION_SERVER_ERROR");else switch(a.compatibilityData.currentCompatibilityStatus.state){case t.STATE.COMPATIBLE:n=a.compatibilityData.currentCompatibilityStatus.compatibleVersion===!1?r.Text._("COM_JOOMLAUPDATE_VIEW_DEFAULT_EXTENSION_NO_COMPATIBILITY_INFORMATION"):a.compatibilityData.currentCompatibilityStatus.compatibleVersion;break;case t.STATE.INCOMPATIBLE:n=r.Text._("COM_JOOMLAUPDATE_VIEW_DEFAULT_EXTENSION_NO_COMPATIBILITY_INFORMATION");break;case t.STATE.MISSING_COMPATIBILITY_TAG:n=r.Text._("COM_JOOMLAUPDATE_VIEW_DEFAULT_EXTENSION_NO_COMPATIBILITY_INFORMATION");break;default:n=r.Text._("COM_JOOMLAUPDATE_VIEW_DEFAULT_EXTENSION_WARNING_UNKNOWN")}var s=a.element.getAttribute("data-extension-id");i.getElementById("available-version-"+s).innerText=n;var e=i.querySelector("#compatibilityTable"+a.compatibilityData.resultGroup+" tbody");if(e&&e.appendChild(a.element.closest("tr")),i.getElementById("compatibilityTable"+a.compatibilityData.resultGroup).classList.remove("hidden"),a.compatibilityData.resultGroup===3&&(t.nonCoreCriticalPlugins=t.nonCoreCriticalPlugins.filter(function(o){return!(o.package_id.toString()===s||o.extension_id.toString()===s)})),!i.querySelector("#compatibilityTable0 tbody td")){i.getElementById("compatibilityTable0").classList.add("hidden");var c="success";t.nonCoreCriticalPlugins.forEach(function(o){var d=i.querySelector('td[data-extension-id="'+o.extension_id+'"]');if(d||(d=i.querySelector('td[data-extension-id="'+o.package_id+'"]')),d){var E=d.closest("tr");E.classList.add("error");var u=E.querySelector(".exname");u.innerHTML=r.sanitizeHtml(u.innerHTML)+`
              <div class="small">
              `+(i.querySelector('td[data-extension-id="'+o.extension_id+'"]')?"":" - "+o.name)+`
              <span class="badge bg-warning">
              <span class="icon-warning"></span>
              `+r.Text._("COM_JOOMLAUPDATE_VIEW_DEFAULT_POTENTIALLY_DANGEROUS_PLUGIN")+`
              </span>

              <button type="button" class="btn btn-sm btn-link hasPopover"
              title="`+r.Text._("COM_JOOMLAUPDATE_VIEW_DEFAULT_POTENTIALLY_DANGEROUS_PLUGIN")+` "
              data-bs-content="`+r.Text._("COM_JOOMLAUPDATE_VIEW_DEFAULT_POTENTIALLY_DANGEROUS_PLUGIN_DESC")+` "
              >
              `+r.Text._("COM_JOOMLAUPDATE_VIEW_DEFAULT_HELP")+`
              </button>
              </div>`;var _=u.querySelector(".hasPopover");_&&(_.style.cursor="pointer",new bootstrap.Popover(_,{placement:"top",html:!0,trigger:"focus"})),c="danger"}}),i.querySelector("#compatibilityTable2 tbody td")?c="danger":c!=="danger"&&i.querySelector("#compatibilityTable1 tbody td")&&(c="warning"),t.nonCoreCriticalPlugins.length===0&&c==="success"&&i.getElementById("preupdatecheckbox")&&(i.getElementById("preupdatecheckbox").style.display="none"),t.nonCoreCriticalPlugins.length===0&&c==="success"&&i.getElementById("noncoreplugins")&&(i.getElementById("noncoreplugins").checked=!0),t.nonCoreCriticalPlugins.length===0&&c==="success"?[].slice.call(i.querySelectorAll("button.submitupdate")).forEach(function(o){o.classList.remove("disabled"),o.removeAttribute("disabled")}):t.nonCoreCriticalPlugins.length>0&&i.getElementById("preupdateCheckCompleteProblems").classList.remove("hidden"),t.cleanup(c)}},i.getElementById("preupdatecheck")!==null&&i.addEventListener("DOMContentLoaded",t.run,!1)}(Joomla,document)})();
