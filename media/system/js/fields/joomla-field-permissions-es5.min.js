(function(){"use strict";function y(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,u(e,r)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},d(e)}function u(e,r){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},u(e,r)}function _(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function f(e,r,s){return _()?f=Reflect.construct.bind():f=function(o,i,n){var c=[null];c.push.apply(c,i);var h=Function.bind.apply(o,c),l=new h;return n&&u(l,n.prototype),l},f.apply(null,arguments)}function w(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function m(e){var r=typeof Map=="function"?new Map:void 0;return m=function(t){if(t===null||!w(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r<"u"){if(r.has(t))return r.get(t);r.set(t,o)}function o(){return f(t,arguments,d(this).constructor)}return o.prototype=Object.create(t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),u(o,t)},m(e)}function v(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}/**
 * @copyright  (C) 2019 Open Source Matters, Inc. <https://www.joomla.org>
 * @license    GNU General Public License version 2 or later; see LICENSE.txt
 */window.customElements.define("joomla-field-permissions",function(e){y(r,e);function r(){var t;if(t=e.call(this)||this,!Joomla)throw new Error("Joomla API is not properly initiated");if(!t.getAttribute("data-uri"))throw new Error("No valid url for validation");return t.query=window.location.search.substring(1),t.buttons="",t.buttonDataSelector="data-onchange-task",t.onDropdownChange=t.onDropdownChange.bind(v(t)),t.getUrlParam=t.getUrlParam.bind(v(t)),t.component=t.getUrlParam("component"),t.extension=t.getUrlParam("extension"),t.option=t.getUrlParam("option"),t.view=t.getUrlParam("view"),t.asset="not",t.context="",t}var s=r.prototype;return s.connectedCallback=function(){var o=this;this.buttons=[].slice.call(document.querySelectorAll("["+this.buttonDataSelector+"]")),this.buttons&&this.buttons.forEach(function(i){i.addEventListener("change",o.onDropdownChange)})},s.disconnectedCallback=function(){var o=this;this.buttons&&this.buttons.forEach(function(i){i.removeEventListener("change",o.onDropdownChange)})},s.onDropdownChange=function(o){o.preventDefault();var i=o.target.getAttribute(this.buttonDataSelector);i==="permissions.apply"&&this.sendPermissions(o)},s.sendPermissions=function(o){var i=o.target,n=document.getElementById("icon_"+i.id);n.removeAttribute("class"),n.setAttribute("class","joomla-icon joomla-field-permissions__spinner");var c=i.value;if(document.getElementById("jform_context")){this.context=document.getElementById("jform_context").value;var h=this.context.split(".");this.context=h[0]}this.option==="com_config"&&!this.component&&!this.extension?this.asset="root.1":!this.extension&&this.view==="component"?this.asset=this.component:this.context?(this.view==="group"?this.asset=this.context+".fieldgroup."+this.getUrlParam("id"):this.asset=this.context+".field.{this.getUrlParam('id')}",this.title=document.getElementById("jform_title").value):this.extension&&this.view?(this.asset=this.extension+"."+this.view+"."+this.getUrlParam("id"),this.title=document.getElementById("jform_title").value):!this.extension&&this.view&&(this.asset=this.option+"."+this.view+"."+this.getUrlParam("id"),this.title=document.getElementById("jform_title").value);var l=i.id.replace("jform_rules_",""),b=l.lastIndexOf("_"),P={comp:this.asset,action:l.substring(0,b),rule:l.substring(b+1),value:c,title:this.title};Joomla.removeMessages(),Joomla.request({url:this.getAttribute("data-uri"),method:"POST",data:JSON.stringify(P),perform:!0,headers:{"Content-Type":"application/json"},onSuccess:function(p){var a;try{a=JSON.parse(p)}catch(x){console.error(x)}if(n.removeAttribute("class"),a.data&&a.data.result){n.setAttribute("class","joomla-icon joomla-field-permissions__allowed");var g=i.parentNode.parentNode.nextElementSibling.querySelector("span");g.removeAttribute("class"),g.setAttribute("class",a.data.class),g.innerHTML=Joomla.sanitizeHtml(a.data.text)}typeof a.messages=="object"&&a.messages!==null&&(Joomla.renderMessages(a.messages),a.data&&a.data.result?n.setAttribute("class","joomla-icon joomla-field-permissions__allowed"):n.setAttribute("class","joomla-icon joomla-field-permissions__denied"))},onError:function(p){n.removeAttribute("style"),Joomla.renderMessages(Joomla.ajaxErrorsMessages(p,p.statusText)),n.setAttribute("class","joomla-icon joomla-field-permissions__denied")}})},s.getUrlParam=function(o){var i=this.query.split("&"),n=0;for(n;n<i.length;n+=1){var c=i[n].split("=");if(c[0]===o)return c[1]}return!1},r}(m(HTMLElement)))})();
