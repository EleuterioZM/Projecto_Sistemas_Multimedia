class TableColumns{constructor(t,l){this.$table=t,this.tableName=l,this.storageKey=`joomla-tablecolumns-${this.tableName}`,this.$headers=[].slice.call(t.querySelector("thead tr").children),this.$rows=[].slice.call(t.querySelectorAll("tbody tr")),this.listOfHidden=[],this.loadState(),this.protectedCols=[0],this.$rows[0]&&[].slice.call(this.$rows[0].children).forEach((e,i)=>{if(e.nodeName==="TH"){this.protectedCols.push(i);const s=this.listOfHidden.indexOf(i);s!==-1&&this.listOfHidden.splice(s,1)}}),this.createControls(),this.listOfHidden.forEach(e=>{this.toggleColumn(e,!0)})}createControls(){const t=document.createElement("div");t.setAttribute("class","dropdown float-end pb-2");const l=document.createElement("div");l.setAttribute("class","dropdown-menu dropdown-menu-end"),l.setAttribute("data-bs-popper","static");const e=document.createElement("button");e.type="button",e.textContent=Joomla.Text._("JGLOBAL_COLUMNS"),e.classList.add("btn","btn-primary","btn-sm","dropdown-toggle"),e.setAttribute("data-bs-toggle","dropdown"),e.setAttribute("data-bs-auto-close","false"),e.setAttribute("aria-haspopup","true"),e.setAttribute("aria-expanded","false");const i=document.createElement("ul");i.setAttribute("class","list-unstyled p-2 text-nowrap mb-0"),i.setAttribute("id","columnList"),this.$headers.forEach((s,o)=>{if(o===0&&s.nodeName!=="TH")return;const h=document.createElement("li"),c=document.createElement("label"),n=document.createElement("input");n.classList.add("form-check-input","me-1"),n.type="checkbox",n.name="table[column][]",n.checked=this.listOfHidden.indexOf(o)===-1,n.disabled=this.protectedCols.indexOf(o)!==-1,n.value=o;let r=s.querySelector("span"),a=r?r.textContent.trim():"";a||(r=s.querySelector("span.visually-hidden")||s,a=r.textContent.trim()),a.includes(":")&&(a=a.split(":",2)[1].trim()),c.textContent=a,c.insertAdjacentElement("afterbegin",n),h.appendChild(c),i.appendChild(h)}),this.$table.insertAdjacentElement("beforebegin",t),t.appendChild(e),t.appendChild(l),l.appendChild(i),i.addEventListener("change",s=>{this.toggleColumn(parseInt(s.target.value,10)),this.saveState()}),this.$headers.forEach(s=>{s.classList.remove("d-none","d-xs-table-cell","d-sm-table-cell","d-md-table-cell","d-lg-table-cell","d-xl-table-cell","d-xxl-table-cell")}),this.$rows.forEach(s=>{[].slice.call(s.children).forEach(o=>{o.classList.remove("d-none","d-xs-table-cell","d-sm-table-cell","d-md-table-cell","d-lg-table-cell","d-xl-table-cell","d-xxl-table-cell")})}),this.$button=e,this.$menu=i,this.updateCounter()}updateCounter(){const t=this.$headers.length-1,l=t-this.listOfHidden.length;this.$button.textContent=`${l}/${t} ${Joomla.Text._("JGLOBAL_COLUMNS")}`}toggleColumn(t,l){if(!this.$headers[t]||this.protectedCols.indexOf(t)!==-1)return;const e=this.listOfHidden.indexOf(t);e===-1?this.listOfHidden.push(t):l!==!0&&this.listOfHidden.splice(e,1),this.$headers[t].classList.toggle("d-none",l),this.$rows.forEach(i=>{i.children[t].classList.toggle("d-none",l)}),this.updateCounter()}saveState(){window.localStorage.setItem(this.storageKey,this.listOfHidden.join(","))}loadState(){const t=window.localStorage.getItem(this.storageKey);t&&(this.listOfHidden=t.split(",").map(l=>parseInt(l,10)))}}window.innerWidth>992&&[...document.querySelectorAll("table:not(.columns-order-ignore)")].forEach(d=>{const t=d.dataset.name?d.dataset.name:document.querySelector(".page-title").textContent.trim().replace(/[^a-z0-9]/gi,"-").toLowerCase();t&&new TableColumns(d,t)});
