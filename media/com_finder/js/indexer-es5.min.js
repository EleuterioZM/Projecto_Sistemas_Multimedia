(function(){"use strict";/**
 * @copyright  (C) 2018 Open Source Matters, Inc. <https://www.joomla.org>
 * @license    GNU General Public License version 2 or later; see LICENSE.txt
 */(function(i,a){if(!i)throw new Error("core.js was not properly initialised");i.finderIndexer=function(){var E,o=null,p=null,d=null,u=!1,_="index.php?option=com_finder&tmpl=component&format=json",v="&"+a.getElementById("finder-indexer-token").getAttribute("name")+"=1",c=function(e){var s=a.getElementById(e);return s?s.parentNode.removeChild(s):null},R=function(e,s){d=p/o*100;var t=a.getElementById("progress-bar"),r=a.getElementById("finder-progress-header"),f=a.getElementById("finder-progress-message");r&&(r.innerText=e),f&&(f.innerHTML=i.sanitizeHtml(s)),t&&(d<100?(t.style.width=d+"%",t.setAttribute("aria-valuenow",d)):(t.classList.remove("bar-success"),t.classList.add("bar-warning"),t.setAttribute("aria-valuemin",100),t.setAttribute("aria-valuemax",200),t.style.width=d+"%",t.setAttribute("aria-valuenow",d)),s===i.Text._("COM_FINDER_INDEXER_MESSAGE_COMPLETE")&&(c("progress"),window.parent.Joomla.Modal.getCurrent().close()))},h=function(e,s){var t=a.getElementById("finder-progress-header"),r=a.getElementById("finder-progress-message");try{if(e===null)throw new Error(s);if(e.error)throw new Error(e);if(e.start&&(o=e.totalItems,a.getElementById("finder-debug-data"))){var f=a.getElementById("finder-debug-data");Object.entries(e.pluginState).forEach(function(n){var g='<dt class="col-sm-3">'+n[0]+"</dt>";g+='<dd id="finder-'+n[0].replace(/\s+/g,"-").toLowerCase()+'" class="col-sm-9"></dd>',f.insertAdjacentHTML("beforeend",i.sanitizeHtml(g,{dd:["class","id"],dt:["class"]}))})}p+=e.batchOffset,R(e.header,e.message),a.getElementById("finder-debug-data")&&Object.entries(e.pluginState).forEach(function(n){a.getElementById("finder-"+n[0].replace(/\s+/g,"-").toLowerCase()).innerHTML=i.sanitizeHtml(e.pluginState[n[0]].offset+" of "+e.pluginState[n[0]].total)}),p<o?E("indexer.batch"):u||(u=!0,E("indexer.optimize"))}catch(n){c("progress");try{e.error&&(t&&(t.innerText=e.header,t.classList.add("finder-error")),r&&(r.innerHTML=i.sanitizeHtml(e.message),r.classList.add("finder-error")))}catch{n===""&&(n=i.Text._("COM_FINDER_NO_ERROR_RETURNED")),t&&(t.innerText=i.Text._("COM_FINDER_AN_ERROR_HAS_OCCURRED"),t.classList.add("finder-error")),r&&(r.innerHTML=i.sanitizeHtml(n),r.classList.add("finder-error"))}}return!0},m=function(e){var s=a.getElementById("finder-progress-header"),t=a.getElementById("finder-progress-message"),r;if(e instanceof Error){var f=a.createElement("div");f.textContent=e.message,r=f.innerHTML,e instanceof SyntaxError&&(r=i.Text._("JLIB_JS_AJAX_ERROR_PARSE").replace("%s",r))}else if(typeof e=="object"&&e.responseText){r=e.responseText;try{r=JSON.parse(r)}catch{r=i.Text._("JLIB_JS_AJAX_ERROR_OTHER").replace("%s",e.status)}}c("progress");var n=r&&r.header?r.header:i.Text._("COM_FINDER_AN_ERROR_HAS_OCCURRED"),g=r&&r.message?r.message:i.Text._("COM_FINDER_MESSAGE_RETURNED")+"<br>"+r;s&&(s.innerText=n,s.classList.add("finder-error")),t&&(t.innerHTML=i.sanitizeHtml(g),t.classList.add("finder-error"))};E=function(e){i.request({url:_+"&task="+e+v,promise:!0}).then(function(s){h(JSON.parse(s.responseText))}).catch(function(s){m(s)})};var I=function(){p=0,d=0,E("indexer.start")};I()}})(Joomla,document),document.addEventListener("DOMContentLoaded",function(){window.Indexer=Joomla.finderIndexer()})})();
