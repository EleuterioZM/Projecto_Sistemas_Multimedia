(function(){"use strict";function A(){A=function(){return c};var d,c={},s=Object.prototype,i=s.hasOwnProperty,f=Object.defineProperty||function(e,t,r){e[t]=r.value},a=typeof Symbol=="function"?Symbol:{},h=a.iterator||"@@iterator",m=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function g(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{g({},"")}catch{g=function(t,r,o){return t[r]=o}}function I(e,t,r,o){var n=t&&t.prototype instanceof U?t:U,l=Object.create(n.prototype),p=new N(o||[]);return f(l,"_invoke",{value:$(e,r,p)}),l}function M(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(o){return{type:"throw",arg:o}}}c.wrap=I;var x="suspendedStart",L="suspendedYield",b="executing",J="completed",w={};function U(){}function k(){}function E(){}var C={};g(C,h,function(){return this});var S=Object.getPrototypeOf,_=S&&S(S(D([])));_&&_!==s&&i.call(_,h)&&(C=_);var j=E.prototype=U.prototype=Object.create(C);function q(e){["next","throw","return"].forEach(function(t){g(e,t,function(r){return this._invoke(t,r)})})}function R(e,t){function r(n,l,p,v){var y=M(e[n],e,l);if(y.type!=="throw"){var B=y.arg,T=B.value;return T&&typeof T=="object"&&i.call(T,"__await")?t.resolve(T.__await).then(function(P){r("next",P,p,v)},function(P){r("throw",P,p,v)}):t.resolve(T).then(function(P){B.value=P,p(B)},function(P){return r("throw",P,p,v)})}v(y.arg)}var o;f(this,"_invoke",{value:function(n,l){function p(){return new t(function(v,y){r(n,l,v,y)})}return o=o?o.then(p,p):p()}})}function $(e,t,r){var o=x;return function(n,l){if(o===b)throw new Error("Generator is already running");if(o===J){if(n==="throw")throw l;return{value:d,done:!0}}for(r.method=n,r.arg=l;;){var p=r.delegate;if(p){var v=W(p,r);if(v){if(v===w)continue;return v}}if(r.method==="next")r.sent=r._sent=r.arg;else if(r.method==="throw"){if(o===x)throw o=J,r.arg;r.dispatchException(r.arg)}else r.method==="return"&&r.abrupt("return",r.arg);o=b;var y=M(e,t,r);if(y.type==="normal"){if(o=r.done?J:L,y.arg===w)continue;return{value:y.arg,done:r.done}}y.type==="throw"&&(o=J,r.method="throw",r.arg=y.arg)}}}function W(e,t){var r=t.method,o=e.iterator[r];if(o===d)return t.delegate=null,r==="throw"&&e.iterator.return&&(t.method="return",t.arg=d,W(e,t),t.method==="throw")||r!=="return"&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),w;var n=M(o,e.iterator,t.arg);if(n.type==="throw")return t.method="throw",t.arg=n.arg,t.delegate=null,w;var l=n.arg;return l?l.done?(t[e.resultName]=l.value,t.next=e.nextLoc,t.method!=="return"&&(t.method="next",t.arg=d),t.delegate=null,w):l:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,w)}function X(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function G(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(X,this),this.reset(!0)}function D(e){if(e||e===""){var t=e[h];if(t)return t.call(e);if(typeof e.next=="function")return e;if(!isNaN(e.length)){var r=-1,o=function n(){for(;++r<e.length;)if(i.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=d,n.done=!0,n};return o.next=o}}throw new TypeError(typeof e+" is not iterable")}return k.prototype=E,f(j,"constructor",{value:E,configurable:!0}),f(E,"constructor",{value:k,configurable:!0}),k.displayName=g(E,u,"GeneratorFunction"),c.isGeneratorFunction=function(e){var t=typeof e=="function"&&e.constructor;return!!t&&(t===k||(t.displayName||t.name)==="GeneratorFunction")},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,g(e,u,"GeneratorFunction")),e.prototype=Object.create(j),e},c.awrap=function(e){return{__await:e}},q(R.prototype),g(R.prototype,m,function(){return this}),c.AsyncIterator=R,c.async=function(e,t,r,o,n){n===void 0&&(n=Promise);var l=new R(I(e,t,r,o),n);return c.isGeneratorFunction(t)?l:l.next().then(function(p){return p.done?p.value:l.next()})},q(j),g(j,u,"Generator"),g(j,h,function(){return this}),g(j,"toString",function(){return"[object Generator]"}),c.keys=function(e){var t=Object(e),r=[];for(var o in t)r.push(o);return r.reverse(),function n(){for(;r.length;){var l=r.pop();if(l in t)return n.value=l,n.done=!1,n}return n.done=!0,n}},c.values=D,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=d,this.done=!1,this.delegate=null,this.method="next",this.arg=d,this.tryEntries.forEach(G),!e)for(var t in this)t.charAt(0)==="t"&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=d)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(y,B){return l.type="throw",l.arg=e,t.next=y,B&&(t.method="next",t.arg=d),!!B}for(var o=this.tryEntries.length-1;o>=0;--o){var n=this.tryEntries[o],l=n.completion;if(n.tryLoc==="root")return r("end");if(n.tryLoc<=this.prev){var p=i.call(n,"catchLoc"),v=i.call(n,"finallyLoc");if(p&&v){if(this.prev<n.catchLoc)return r(n.catchLoc,!0);if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else if(p){if(this.prev<n.catchLoc)return r(n.catchLoc,!0)}else{if(!v)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return r(n.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&i.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var n=o;break}}n&&(e==="break"||e==="continue")&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var l=n?n.completion:{};return l.type=e,l.arg=t,n?(this.method="next",this.next=n.finallyLoc,w):this.complete(l)},complete:function(e,t){if(e.type==="throw")throw e.arg;return e.type==="break"||e.type==="continue"?this.next=e.arg:e.type==="return"?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):e.type==="normal"&&t&&(this.next=t),w},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),G(r),w}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var o=r.completion;if(o.type==="throw"){var n=o.arg;G(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:D(e),resultName:t,nextLoc:r},this.method==="next"&&(this.arg=d),w}},c}function F(d,c,s,i,f,a,h){try{var m=d[a](h),u=m.value}catch(g){s(g);return}m.done?c(u):Promise.resolve(u).then(i,f)}function H(d){return function(){var c=this,s=arguments;return new Promise(function(i,f){var a=d.apply(c,s);function h(u){F(a,i,f,h,m,"next",u)}function m(u){F(a,i,f,h,m,"throw",u)}h(void 0)})}}/**
 * @copyright  (C) 2018 Open Source Matters, Inc. <https://www.joomla.org>
 * @license    GNU General Public License version 2 or later; see LICENSE.txt
 */if(!Joomla)throw new Error("Joomla API is not properly initialized");Joomla.MediaManager=Joomla.MediaManager||{};var z=function(){function d(){var s=this;if(this.options=Joomla.getOptions("com_media",{}),!this.options)throw new Error('Initialization error "edit-images.js"');if(this.extension=this.options.uploadPath.split(".").pop(),this.fileType=["jpeg","jpg"].includes(this.extension)?"jpeg":this.extension,this.options.currentUrl=new URL(window.location.href),this.original={filename:this.options.uploadPath.split("/").pop(),extension:this.extension,contents:"data:image/"+this.fileType+";base64,"+this.options.contents},this.previousPluginDeactivated=new Promise(function(i){return i}),this.history={},this.current=this.original,this.plugins={},this.baseContainer=document.getElementById("media-manager-edit-container"),!this.baseContainer)throw new Error("The image preview container is missing");this.createImageContainer(this.original),Joomla.MediaManager.Edit=this,window.dispatchEvent(new CustomEvent("media-manager-edit-init")),customElements.whenDefined("joomla-tab").then(H(A().mark(function i(){var f,a,h;return A().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:f=document.getElementById("myTab"),a=f.firstElementChild,h=[].slice.call(a.querySelectorAll("button[aria-controls]")),h.forEach(function(g,I){var M=document.getElementById(g.getAttribute("aria-controls"));I===0&&M.insertAdjacentElement("beforeend",s.baseContainer),g.addEventListener("joomla.tab.hidden",function(x){var L=x.target;if(!L){s.previousPluginDeactivated=new Promise(function(b){return b});return}s.previousPluginDeactivated=new Promise(function(b,J){s.plugins[L.getAttribute("aria-controls").replace("attrib-","")].Deactivate(s.imagePreview).then(b).catch(function(w){console.log(w),J()})})}),g.addEventListener("joomla.tab.shown",function(x){var L=x.target;M.insertAdjacentElement("beforeend",s.baseContainer),s.previousPluginDeactivated.then(function(){return s.plugins[L.getAttribute("aria-controls").replace("attrib-","")].Activate(s.imagePreview)}).catch(function(b){console.log(b)})})}),f.activateTab(0,!1);case 5:case"end":return u.stop()}},i)}))),this.addHistoryPoint=this.addHistoryPoint.bind(this),this.createImageContainer=this.createImageContainer.bind(this),this.Reset=this.Reset.bind(this),this.Undo=this.Undo.bind(this),this.Redo=this.Redo.bind(this),this.createProgressBar=this.createProgressBar.bind(this),this.updateProgressBar=this.updateProgressBar.bind(this),this.removeProgressBar=this.removeProgressBar.bind(this),this.upload=this.upload.bind(this),window.addEventListener("mediaManager.history.point",this.addHistoryPoint.bind(this))}var c=d.prototype;return c.addHistoryPoint=function(){if(this.original!==this.current){var i=Object.keys(this.history).length;if(this.history[i]&&this.history[i-1]&&this.history[i]===this.history[i-1])return;this.history[i+1]=this.current}},c.createImageContainer=function(i){if(!i.contents)throw new Error('Initialization error "edit-images.js"');this.imagePreview=document.createElement("img"),this.imagePreview.src=i.contents,this.imagePreview.id="image-preview",this.imagePreview.style.height="auto",this.imagePreview.style.maxWidth="100%",this.baseContainer.appendChild(this.imagePreview)},c.Reset=function(){var i=this;this.current.contents="data:image/"+this.fileType+";base64,"+this.options.contents,this.imagePreview.setAttribute("src",this.current.contents),requestAnimationFrame(function(){requestAnimationFrame(function(){i.imagePreview.setAttribute("width",i.imagePreview.naturalWidth),i.imagePreview.setAttribute("height",i.imagePreview.naturalHeight)})})},c.Undo=function(){},c.Redo=function(){},c.createProgressBar=function(){},c.updateProgressBar=function(){},c.removeProgressBar=function(){},c.upload=function(i,f){var a=this,h,m=Joomla.MediaManager.Edit.original.extension==="jpg"?"jpeg":Joomla.MediaManager.Edit.original.extension;if(m||(m=/data:image\/(.+);/gm.exec(Joomla.MediaManager.Edit.original.contents)[1]),!m)throw new Error("Unable to determine image format");this.xhr=new XMLHttpRequest,typeof f=="function"&&(this.xhr.onreadystatechange=f),this.xhr.upload.onprogress=function(u){a.updateProgressBar(u.loaded/u.total*100)},this.xhr.onload=function(){var u;try{u=JSON.parse(a.xhr.responseText)}catch{u=null}u?a.xhr.status===200&&(u.success===!0&&a.removeProgressBar(),u.status==="1"&&(Joomla.renderMessages({success:[u.message]},"true"),a.removeProgressBar())):a.removeProgressBar(),a.xhr=null},this.xhr.onerror=function(){a.removeProgressBar(),a.xhr=null},this.xhr.open("PUT",i,!0),this.xhr.setRequestHeader("Content-Type","application/json"),this.createProgressBar(),this.xhr.send(JSON.stringify((h={name:Joomla.MediaManager.Edit.options.uploadPath.split("/").pop(),content:Joomla.MediaManager.Edit.current.contents.replace("data:image/"+m+";base64,","")},h[Joomla.MediaManager.Edit.options.csrfToken]=1,h)))},d}();new z;var O=function(c){var s=Joomla.MediaManager.Edit.options.currentUrl,i=new URLSearchParams(s.search);i.set("view","media"),i.delete("path"),i.delete("mediatypes");var f=Joomla.MediaManager.Edit.options.uploadPath,a=f.split("/");a.pop(),a=a.join("/"),a.endsWith(":")&&(a=a+"/"),i.set("path",a);var h=document.querySelector('input[name="mediatypes"]');return i.set("mediatypes",h&&h.value?h.value:"0"),c&&i.set("tmpl","component"),s.search=i,s};Joomla.submitbutton=function(d){var c=new URL(Joomla.MediaManager.Edit.options.apiBaseUrl+"&task=api.files&path="+Joomla.MediaManager.Edit.options.uploadPath);switch(d){case"apply":Joomla.MediaManager.Edit.upload(c,null),Joomla.MediaManager.Edit.imagePreview.src=Joomla.MediaManager.Edit.current.contents,Joomla.MediaManager.Edit.original=Joomla.MediaManager.Edit.current,Joomla.MediaManager.Edit.history={},H(A().mark(function s(){var i;return A().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i=[].slice.call(document.querySelectorAll("joomla-tab-element")).filter(function(h){return h.hasAttribute("active")}),a.prev=1,a.next=4,Joomla.MediaManager.Edit.plugins[i[0].id.replace("attrib-","")].Deactivate(Joomla.MediaManager.Edit.imagePreview);case 4:return a.next=6,Joomla.MediaManager.Edit.plugins[i[0].id.replace("attrib-","")].Activate(Joomla.MediaManager.Edit.imagePreview);case 6:a.next=11;break;case 8:a.prev=8,a.t0=a.catch(1),console.log(a.t0);case 11:case"end":return a.stop()}},s,null,[[1,8]])}))();break;case"save":Joomla.MediaManager.Edit.upload(c,function(){Joomla.MediaManager.Edit.xhr.readyState===XMLHttpRequest.DONE&&(window.self!==window.top?window.location=O(!0):window.location=O())});break;case"cancel":window.self!==window.top?window.location=O(!0):window.location=O();break;case"reset":Joomla.MediaManager.Edit.Reset("initial");break}}})();
