(function(){"use strict";/**
 * @copyright  (C) 2018 Open Source Matters, Inc. <https://www.joomla.org>
 * @license    GNU General Public License version 2 or later; see LICENSE.txt
 */var r,i=!1,a,c=function(){r.cropX.addEventListener("change",function(t){var e=t.currentTarget;a.setData({x:parseInt(e.value,10)})}),r.cropY.addEventListener("change",function(t){var e=t.currentTarget;a.setData({y:parseInt(e.value,10)})}),r.cropWidth.addEventListener("change",function(t){var e=t.currentTarget;a.setData({width:parseInt(e.value,10)})}),r.cropHeight.addEventListener("change",function(t){var e=t.currentTarget;a.setData({height:parseInt(e.value,10)})}),r.aspectRatio.addEventListener("change",function(t){var e=t.currentTarget;a.setAspectRatio(e.value)}),i=!0},u=function(t){var e=t.naturalWidth/t.naturalHeight;!Number.isNaN(e)&&Number.isFinite(e)&&(r.cropAspectRatioOption.value=e),a=new Cropper(t,{viewMode:1,responsive:!0,restore:!0,autoCrop:!0,movable:!1,zoomable:!1,rotatable:!1,autoCropArea:1,crop:function(n){r.cropX.value=Math.round(n.detail.x),r.cropY.value=Math.round(n.detail.y),r.cropWidth.value=Math.round(n.detail.width),r.cropHeight.value=Math.round(n.detail.height);var d=Joomla.MediaManager.Edit.original.extension==="jpg"?"jpeg":Joomla.MediaManager.Edit.original.extension,p=r.cropQuality.value;Joomla.MediaManager.Edit.current.contents=this.cropper.getCroppedCanvas().toDataURL("image/"+d,p),window.dispatchEvent(new Event("mediaManager.history.point"))}}),i||c(),a.setAspectRatio(r.cropAspectRatioOption.value)};window.addEventListener("media-manager-edit-init",function(){r={aspectRatio:document.getElementById("jform_aspectRatio"),cropHeight:document.getElementById("jform_crop_height"),cropWidth:document.getElementById("jform_crop_width"),cropY:document.getElementById("jform_crop_y"),cropX:document.getElementById("jform_crop_x"),cropQuality:document.getElementById("jform_crop_quality"),cropAspectRatioOption:document.querySelector(".crop-aspect-ratio-option")},Joomla.MediaManager.Edit.plugins.crop={Activate:function(t){return new Promise(function(e){u(t),e()})},Deactivate:function(t){return new Promise(function(e){t.cropper&&(t.cropper.destroy(),a=null),e()})}}},{once:!0})})();
